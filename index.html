<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>資產盤點</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin-top: 50px;font-size:1.2em; }
  </style>
  <script charset="utf-8" src="https://static.worksmobile.net/static/wm/woff/edge/3.7.1/sdk.js"></script>
</head>
<body>
  <h1>未盤點明細</h1>
  <div>保管人：<span id="user_id"></span></div>
  <div id="assetList" align="center">載入中...</div>
  
  <script>
  
const urlParams = new URLSearchParams(window.location.search);
const encodedState = urlParams.get('woff.state');

if (encodedState) {
  // 第一次解碼
  const firstDecode = decodeURIComponent(encodedState);

  // 取得 name 參數
  const innerParams = new URLSearchParams(firstDecode);
  const encodedName = innerParams.get('name');

  // 第二次解碼
  const decodedName = decodeURIComponent(encodedName);

  document.getElementById("user_id").innerText = decodedName;
}


  const userName=document.getElementById('user_id').innerHTML
  fetch('https://keeperlist-468585210906.asia-east1.run.app', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ user_name: { value: userName } })
  })
  .then(res => res.json())
  .then(data => {
    
  // 取出 records
  const records = data.records;
  
  // 轉換成簡單陣列
  const assets = records.map(record => {
    return {
      資產號碼組合: record["資產號碼組合"].value,
      製品名: record["製品名"].value,
      存放地點: record["存放地點"].value
    };
  });
console.log(assets.length)

// 顯示成表格
  if(assets.length>0){
    const html = `
    <table border="1" style="width:100%; text-align:left;">
      <tr><th>資產號碼</th><th>製品名</th><th>存放地點</th></tr>
      ${assets.map(item => `
        <tr>
          <td>${item.資產號碼組合}</td>
          <td>${item.製品名}</td>
          <td>${item.存放地點}</td>
        </tr>
      `).join('')}
    </table>
  `;
    document.getElementById('assetList').innerHTML = html;
  }
  else{
    document.getElementById('assetList').innerHTML = "盤點完成！";
  }
  
    
})
  .catch(err => console.error(err));

</script>

</body>



</html>
















































